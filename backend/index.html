<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard | BestCamp Admin</title>
  
  <!-- Font Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
  <!-- AdminLTE Core -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/css/adminlte.min.css">
  
  <!-- ChartJS -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- SheetJS (Library Excel) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- jsPDF & AutoTable (Library PDF) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
  
  <style>
    /* --- CORE STYLE --- */
    body {
        font-family: 'Poppins', sans-serif;
        background-color: #F8FAFC;
        color: #334155;
    }

    /* 1. SIDEBAR MODERN & SYMMETRICAL */
    .main-sidebar {
        background-color: #FFFFFF !important;
        box-shadow: 4px 0 25px rgba(0,0,0,0.03) !important;
        border-right: none;
    }

    /* SPACE FIX: Menambah jarak kanan sidebar agar lebih lega */
    .sidebar {
        padding-right: 25px !important; 
        padding-left: 15px !important;
    }
    
    /* LOGO FIX: Biru Oren & Geser ke Bawah */
    .brand-link {
        border-bottom: 1px solid #f1f5f9 !important;
        padding: 1.8rem 0.5rem 1.2rem 0.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
    }
    .brand-link .brand-image-xs {
        width: 38px; height: 38px;
        background: #005596;
        border-radius: 10px;
        display: flex; align-items: center; justify-content: center;
        color: white; flex-shrink: 0;
        font-size: 18px;
        box-shadow: 0 4px 10px rgba(0, 85, 150, 0.2);
    }
    .brand-link .brand-text {
        font-size: 1.2rem;
        margin-left: 12px;
        font-weight: 700;
        letter-spacing: 0.5px;
    }
    
    .nav-sidebar .nav-item { margin-bottom: 8px; }
    
    .nav-sidebar .nav-link {
        border-radius: 12px !important;
        color: #64748B !important;
        padding: 10px 16px;
        font-weight: 500;
        transition: all 0.2s ease-in-out;
        display: flex;
        align-items: center;
        border: 1px solid transparent; 
    }
    
    /* ICON DALAM LINGKARAN (Normal State) */
    .nav-sidebar .nav-link i {
        margin-right: 12px;
        font-size: 20px;
        width: 36px; height: 36px;
        border-radius: 50%;
        background: #F8FAFC;
        display: flex; align-items: center; justify-content: center;
        transition: all 0.3s;
        color: #64748B;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
    }

    .nav-sidebar .nav-link:hover {
        background-color: #F1F5F9 !important;
        color: #005596 !important;
        transform: translateX(3px);
    }
    .nav-sidebar .nav-link:hover i {
        background: #FFFFFF;
        color: #005596;
        box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }

    /* Active State (Lingkaran Hilang) */
    .nav-sidebar .nav-link.active {
        background-color: #EFF6FF !important;
        color: #005596 !important;
        font-weight: 600;
        border: 1px solid #BFDBFE;
    }
    .nav-sidebar .nav-link.active i {
        background: transparent !important;
        color: #005596 !important;
        box-shadow: none !important;
        font-size: 22px;
    }

    /* --- SIDEBAR MINIMIZED --- */
    body.sidebar-collapse .main-sidebar .nav-link {
        padding: 0 !important;
        width: 44px !important;
        height: 44px !important;
        margin: 0 auto 8px auto !important;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px !important;
    }
    body.sidebar-collapse .main-sidebar .nav-link i {
        margin: 0 !important;
        width: 36px; height: 36px;
        box-shadow: none;
        background: transparent !important;
    }
    body.sidebar-collapse .main-sidebar .nav-link p { display: none !important; }
    
    body.sidebar-collapse .brand-link {
        padding: 1.5rem 0 !important;
        width: 100% !important;
        justify-content: center !important;
    }
    body.sidebar-collapse .brand-text { display: none !important; }
    
    /* 2. NAVBAR */
    .main-header {
        background-color: transparent !important;
        border-bottom: none !important;
        padding: 1rem 1.5rem;
    }

    .btn-circle-nav {
        width: 42px; height: 42px;
        border-radius: 50%;
        display: flex; align-items: center; justify-content: center;
        background: white;
        border: 1px solid #F1F5F9;
        box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        color: #64748B;
        transition: all 0.2s;
        position: relative;
    }
    .btn-circle-nav:hover {
        background: #F8FAFC;
        color: #005596;
        transform: translateY(-1px);
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    /* BUTTON REPORT STYLE */
    .btn-report {
        background-color: #EA6C00;
        border: none;
        transition: all 0.3s;
    }
    .btn-report:hover {
        background-color: #C25A00;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(234, 108, 0, 0.3);
    }

    .dropdown-menu-custom {
        border: none;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        padding: 8px;
        margin-top: 12px !important;
        width: 280px;
    }
    .dropdown-item-custom {
        padding: 12px 16px;
        border-radius: 10px;
        font-size: 0.9rem;
        color: #334155;
        transition: all 0.2s;
        display: flex; align-items: center; justify-content: center;
    }
    .dropdown-item-custom:hover {
        background-color: #FFF1F2;
        color: #E11D48;
    }
    .dropdown-header-custom {
        padding: 10px 16px;
        font-weight: 600;
        color: #0f172a;
        font-size: 0.85rem;
        border-bottom: 1px solid #f1f5f9;
        margin-bottom: 8px;
    }

    .profile-pill {
        background: white;
        padding: 6px 6px 6px 16px;
        border-radius: 50px;
        border: 1px solid #F1F5F9;
        box-shadow: 0 2px 5px rgba(0,0,0,0.02);
        transition: all 0.2s;
        cursor: pointer;
    }
    .profile-pill:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        border-color: #e2e8f0;
    }

    /* 3. CARDS & CONTENT */
    .content-wrapper { background-color: #F8FAFC !important; }
    
    .card-modern {
        background: white;
        border-radius: 20px;
        border: 1px solid #F1F5F9;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.02);
        transition: all 0.3s ease;
        overflow: hidden;
        margin-bottom: 24px;
        position: relative;
    }
    .card-modern:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 85, 150, 0.08);
        border-color: #BFDBFE;
    }

    .stat-icon-bg {
        width: 50px; height: 50px;
        border-radius: 14px;
        display: flex; align-items: center; justify-content: center;
        font-size: 24px;
        margin-bottom: 16px;
    }
    
    .table-modern thead th {
        background-color: #F8FAFC;
        border-bottom: none;
        color: #64748B;
        font-weight: 600;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        padding: 1.2rem 1.5rem;
    }
    .table-modern tbody td {
        padding: 1.25rem 1.5rem;
        vertical-align: middle;
        border-bottom: 1px solid #F1F5F9;
        color: #334155;
        font-size: 0.9rem;
        font-weight: 500;
    }
    
    .badge-modern { padding: 6px 12px; border-radius: 8px; font-size: 0.75rem; font-weight: 600; }
    .badge-blue { background: #EFF6FF; color: #005596; }
    .badge-orange { background: #FFF7ED; color: #EA6C00; }
    .badge-green { background: #ECFDF5; color: #059669; }

    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
  </style>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-light">
    <!-- Left: Hamburger Menu -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link btn-circle-nav" data-widget="pushmenu" href="#" role="button">
            <i class="fas fa-bars"></i>
        </a>
      </li>
    </ul>
    
    <!-- Right: Notification & Profile -->
    <ul class="navbar-nav ml-auto align-items-center gap-3">
      <!-- Notification Dropdown -->
      <li class="nav-item dropdown mr-3">
        <a class="nav-link btn-circle-nav p-0" data-toggle="dropdown" href="#">
          <i class="material-icons-outlined" style="font-size: 22px;">notifications</i>
          <span class="badge bg-danger rounded-circle position-absolute" id="notif-badge" style="top: 2px; right: 2px; width: 10px; height: 10px; padding: 0; display:none;"></span>
        </a>
        <div class="dropdown-menu dropdown-menu-right dropdown-menu-custom">
            <span class="dropdown-header-custom">Notifikasi Terbaru</span>
            <div id="notif-list">
                <!-- JS Populate -->
            </div>
            <div class="dropdown-divider"></div>
            <a href="data-booking.html" class="dropdown-item-custom text-center text-xs font-weight-bold text-muted">Lihat Semua Data</a>
        </div>
      </li>
      
      <!-- Profile Dropdown -->
      <li class="nav-item dropdown">
        <div class="profile-pill d-flex align-items-center" data-toggle="dropdown" style="cursor: pointer;">
            <div class="d-none d-md-block text-right mr-3">
                <div class="text-xs font-weight-bold text-dark">Administrator</div>
                <div class="text-xs text-muted" style="font-size: 10px; line-height: 1;">Online</div>
            </div>
            <img src="https://ui-avatars.com/api/?name=Admin+BestCamp&background=EA6C00&color=fff" class="rounded-circle shadow-sm" style="width: 34px; height: 34px;">
        </div>
        <div class="dropdown-menu dropdown-menu-right dropdown-menu-custom" style="width: 220px;">
            <div class="px-3 py-3 mb-2 bg-white text-center">
                <img src="https://ui-avatars.com/api/?name=Admin+BestCamp&background=EA6C00&color=fff" class="rounded-circle shadow-sm mb-2" style="width: 60px; height: 60px;">
                <p class="text-sm font-weight-bold m-0 text-dark">Super Admin</p>
                <small class="text-muted text-xs">admin@bestcamp.id</small>
            </div>
            <div class="dropdown-divider"></div>
            <a href="#" onclick="logoutAdmin()" class="dropdown-item-custom text-danger font-weight-bold py-3">
                <i class="fas fa-sign-out-alt mr-2"></i> Keluar Sistem
            </a>
        </div>
      </li>
    </ul>
  </nav>

  <!-- Sidebar -->
  <aside class="main-sidebar">
    <!-- Brand Logo (Final Fix) -->
    <a href="index.html" class="brand-link">
      <div class="brand-image-xs">
        <i class="fas fa-campground"></i>
      </div>
      <div class="brand-text">
          <span style="color: #005596;">Best</span><span style="color: #EA6C00;">Camp</span>
      </div>
    </a>

    <div class="sidebar mt-4">
      <nav class="mt-2">
        <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu">
          <li class="nav-item">
            <a href="index.html" class="nav-link active">
              <i class="nav-icon material-icons-outlined">dashboard</i>
              <p>Dashboard</p>
            </a>
          </li>
          
          <li class="nav-header text-uppercase text-xs font-weight-bold text-muted mt-3 mb-2 pl-2">Operasional</li>
          
          <li class="nav-item">
            <a href="data-booking.html" class="nav-link">
              <i class="nav-icon material-icons-outlined">calendar_today</i>
              <p>Data Booking</p>
            </a>
          </li>
          <li class="nav-item">
            <a href="form-booking.html" class="nav-link">
              <i class="nav-icon material-icons-outlined">add_circle_outline</i>
              <p>Input Sewa</p>
            </a>
          </li>
          
          <li class="nav-item mt-5 pt-3 border-top">
            <a href="#" onclick="logoutAdmin()" class="nav-link text-danger hover:bg-red-50">
              <i class="nav-icon material-icons-outlined">logout</i>
              <p>Keluar</p>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </aside>

  <!-- Content -->
  <div class="content-wrapper px-3">
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-4 align-items-end">
          <div class="col-sm-6">
            <h1 class="m-0 font-weight-bold text-dark text-3xl">Dashboard</h1>
            <p class="text-muted m-0 mt-1 text-sm">Overview performa camping ground hari ini.</p>
          </div>
          <!-- DOWNLOAD BUTTON DENGAN OPSI (DROPDOWN) -->
          <div class="col-sm-6 text-right">
             <div class="btn-group">
                <button type="button" class="btn text-white font-weight-bold btn-sm rounded-pill px-4 shadow-sm py-2 btn-report dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-download mr-1"></i> Download Laporan
                </button>
                <div class="dropdown-menu dropdown-menu-right border-0 shadow-lg rounded-lg">
                    <a class="dropdown-item py-2" href="#" onclick="downloadPDF()">
                        <i class="fas fa-file-pdf mr-2 text-danger"></i> Format PDF (Resmi)
                    </a>
                    <a class="dropdown-item py-2" href="#" onclick="downloadExcel()">
                        <i class="fas fa-file-excel mr-2 text-success"></i> Format Excel (Edit)
                    </a>
                </div>
             </div>
          </div>
        </div>
      </div>
    </div>

    <section class="content">
      <div class="container-fluid">
        
        <!-- Row 1: Statistik -->
        <div class="row">
          <div class="col-lg-4 col-md-6">
            <div class="card-modern p-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="stat-icon-bg" style="background: #EFF6FF; color: #005596;">
                            <span class="material-icons-outlined">receipt_long</span>
                        </div>
                        <p class="text-muted font-weight-bold text-xs text-uppercase mb-1">Total Reservasi</p>
                        <h3 class="font-weight-bold text-dark mb-0" id="totalPesanan">0</h3>
                    </div>
                    <span class="badge badge-green">+12%</span>
                </div>
            </div>
          </div>
          
          <div class="col-lg-4 col-md-6">
            <div class="card-modern p-4">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="stat-icon-bg" style="background: #FFF7ED; color: #EA6C00;">
                            <span class="material-icons-outlined">holiday_village</span>
                        </div>
                        <p class="text-muted font-weight-bold text-xs text-uppercase mb-1">Okupansi Tenda</p>
                        <h3 class="font-weight-bold text-dark mb-0" id="tendaAktif">0%</h3>
                    </div>
                    <span class="badge badge-orange">High</span>
                </div>
            </div>
          </div>

          <div class="col-lg-4 col-md-12">
            <div class="card-modern p-4" style="border-bottom: 4px solid #005596;">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="stat-icon-bg" style="background: #005596; color: white;">
                            <span class="material-icons-outlined">account_balance_wallet</span>
                        </div>
                        <p class="text-muted font-weight-bold text-xs text-uppercase mb-1">Estimasi Pendapatan</p>
                        <h3 class="font-weight-bold text-dark mb-0">Rp <span id="estimasiOmset">0</span></h3>
                    </div>
                    <div class="text-right">
                        <span class="badge badge-blue mb-1">Mingguan</span>
                    </div>
                </div>
            </div>
          </div>
        </div>

        <!-- Row 2: Chart & Recent Activity -->
        <div class="row">
            <div class="col-lg-8">
                <div class="card-modern p-4 h-100">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="font-weight-bold text-dark m-0">Tren Pengunjung</h5>
                        <select class="form-select form-select-sm w-auto border-0 bg-light rounded-pill px-3 text-muted font-weight-bold">
                            <option>Minggu Ini</option>
                            <option>Bulan Ini</option>
                        </select>
                    </div>
                    <div class="position-relative" style="height: 300px;">
                        <canvas id="weeklyChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card-modern p-4 h-100">
                    <h5 class="font-weight-bold text-dark mb-4">Aktivitas Terbaru</h5>
                    <div class="activity-list" id="activityList">
                        <!-- JS Insert -->
                    </div>
                    <button onclick="window.location.href='data-booking.html'" class="btn btn-outline-primary btn-block rounded-pill mt-3 py-2 text-sm font-weight-bold" style="border-color: #005596; color: #005596;">
                        Lihat Detail
                    </button>
                </div>
            </div>
        </div>

        <!-- Row 3: Table Booking -->
        <div class="row mt-5">
            <div class="col-12">
                <div class="card-modern">
                    <div class="card-header bg-white border-0 py-4 px-4 d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="font-weight-bold text-dark m-0">Daftar Tamu Aktif</h5>
                            <p class="text-muted text-xs m-0 mt-1">Status tamu yang sedang menginap saat ini.</p>
                        </div>
                    </div>
                    <div class="card-body p-0 table-responsive">
                        <table class="table table-modern w-100 mb-0">
                            <thead>
                                <tr>
                                    <th class="pl-4">Nama Tamu</th>
                                    <th>Unit</th>
                                    <th>Check-In</th>
                                    <th>Durasi</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="tabelTerbaru">
                                <!-- JS Injection -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

      </div>
    </section>
  </div>
  
  <footer class="main-footer border-0 bg-transparent text-center text-muted text-xs py-4">
    <strong>Copyright &copy; 2025 BestCamp.</strong> All rights reserved.
  </footer>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/admin-lte@3.2/dist/js/adminlte.min.js"></script>

<script>
    if (localStorage.getItem('isAdminLoggedIn') !== 'true') window.location.href = 'login.html';
    
    function logoutAdmin() {
        if(confirm('Keluar sistem?')) { 
            localStorage.removeItem('isAdminLoggedIn'); 
            window.location.href='login.html'; 
        }
    }

    // --- FUNGSI DOWNLOAD EXCEL (Edit) ---
    function downloadExcel() {
        const bookings = JSON.parse(localStorage.getItem('bookings_db')) || [];
        if(bookings.length === 0) { alert("Data kosong!"); return; }

        const dataToExport = bookings.map(b => {
            let price = 350000;
            if(b.tipeTenda.includes('Safari')) price = 750000;
            if(b.tipeTenda.includes('Family')) price = 1200000;
            return {
                "Nama Tamu": b.nama,
                "Tipe Unit": b.tipeTenda,
                "Check-In": b.checkIn,
                "Durasi": parseInt(b.durasi),
                "Jml Orang": parseInt(b.jumlahOrang),
                "Total Biaya": price * parseInt(b.durasi)
            };
        });

        const worksheet = XLSX.utils.json_to_sheet(dataToExport);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Laporan");
        const today = new Date().toISOString().slice(0, 10);
        XLSX.writeFile(workbook, `BestCamp_Laporan_${today}.xlsx`);
    }

    // --- FUNGSI DOWNLOAD PDF (Resmi) ---
    function downloadPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const bookings = JSON.parse(localStorage.getItem('bookings_db')) || [];

        if(bookings.length === 0) { alert("Data kosong!"); return; }

        // Header Laporan
        doc.setFontSize(18);
        doc.text("Laporan Reservasi BestCamp", 14, 22);
        doc.setFontSize(11);
        doc.text(`Tanggal Cetak: ${new Date().toLocaleDateString('id-ID')}`, 14, 30);

        // Siapkan Data Tabel
        const tableColumn = ["No", "Nama Tamu", "Unit", "Check-In", "Durasi", "Total"];
        const tableRows = [];

        bookings.forEach((b, index) => {
            let price = 350000;
            if(b.tipeTenda.includes('Safari')) price = 750000;
            if(b.tipeTenda.includes('Family')) price = 1200000;
            const total = (price * parseInt(b.durasi)).toLocaleString('id-ID');

            const rowData = [
                index + 1,
                b.nama,
                b.tipeTenda,
                b.checkIn,
                b.durasi + " Malam",
                "Rp " + total
            ];
            tableRows.push(rowData);
        });

        // Generate AutoTable
        doc.autoTable({
            head: [tableColumn],
            body: tableRows,
            startY: 40,
            theme: 'grid',
            headStyles: { fillColor: [0, 85, 150] }, // BestCamp Blue
        });

        const today = new Date().toISOString().slice(0, 10);
        doc.save(`BestCamp_Laporan_${today}.pdf`);
    }

    // --- LOGIKA DASHBOARD ---
    function updateNotifications() {
        const bookings = JSON.parse(localStorage.getItem('bookings_db')) || [];
        const notifList = document.getElementById('notif-list');
        const badge = document.getElementById('notif-badge');
        
        notifList.innerHTML = '';
        
        if (bookings.length > 0) {
            badge.style.display = 'block';
            const latest = bookings.slice(-3).reverse();
            
            latest.forEach(b => {
                notifList.innerHTML += `
                    <a href="#" class="dropdown-item-custom" style="justify-content: flex-start;">
                        <div class="d-flex align-items-start">
                            <div class="rounded-circle bg-light d-flex align-items-center justify-content-center mr-2 text-primary" style="width:30px; height:30px; flex-shrink:0;">
                                <i class="fas fa-user text-xs"></i>
                            </div>
                            <div>
                                <p class="text-sm font-weight-bold m-0 text-dark">Booking Baru: ${b.nama}</p>
                                <p class="text-xs text-muted m-0">${b.tipeTenda} - ${b.durasi} Malam</p>
                            </div>
                        </div>
                    </a>
                `;
            });
        } else {
            badge.style.display = 'none';
            notifList.innerHTML = '<div class="text-center text-muted text-xs py-3">Tidak ada notifikasi baru</div>';
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        updateNotifications();

        const bookings = JSON.parse(localStorage.getItem('bookings_db')) || [];
        document.getElementById('totalPesanan').innerText = bookings.length;
        document.getElementById('tendaAktif').innerText = bookings.length > 0 ? "85%" : "0%"; 

        let total = 0;
        bookings.forEach(b => {
            let h = b.tipeTenda === 'Family Cabin' ? 1200000 : (b.tipeTenda === 'Safari Glamping' ? 750000 : 350000);
            total += (h * parseInt(b.durasi));
        });
        document.getElementById('estimasiOmset').innerText = total.toLocaleString('id-ID');

        const tbody = document.getElementById('tabelTerbaru');
        const latest = bookings.slice(-5).reverse();
        
        if(latest.length === 0) {
            tbody.innerHTML = '<tr><td colspan="5" class="text-center text-muted py-5">Belum ada data reservasi masuk.</td></tr>';
        } else {
            latest.forEach(b => {
                let badgeClass = 'badge-blue';
                let initialColor = '#005596';
                if(b.tipeTenda.includes('Safari')) { badgeClass = 'badge-orange'; initialColor = '#EA6C00'; }
                if(b.tipeTenda.includes('Standard')) { badgeClass = 'badge-green'; initialColor = '#059669'; }

                tbody.innerHTML += `
                    <tr>
                        <td class="pl-4">
                            <div class="d-flex align-items-center">
                                <div class="rounded-circle d-flex align-items-center justify-content-center mr-3 text-white font-weight-bold" style="width:35px; height:35px; background-color: ${initialColor}; font-size: 12px;">${b.nama.charAt(0).toUpperCase()}</div>
                                <div class="font-weight-bold text-dark">${b.nama}</div>
                            </div>
                        </td>
                        <td><span class="text-muted text-sm font-weight-bold">${b.tipeTenda}</span></td>
                        <td>${b.checkIn}</td>
                        <td>${b.durasi} Malam</td>
                        <td><span class="badge-modern ${badgeClass}">Confirmed</span></td>
                    </tr>
                `;
            });
        }

        const activityList = document.getElementById('activityList');
        if(latest.length > 0) {
            latest.slice(0,3).forEach(b => {
                activityList.innerHTML += `
                    <div class="d-flex align-items-start mb-4 border-bottom pb-3">
                        <div class="rounded-circle bg-light d-flex align-items-center justify-content-center mr-3" style="width: 38px; height: 38px; min-width:38px; color: #005596;">
                            <i class="fas fa-bell"></i>
                        </div>
                        <div class="overflow-hidden w-100">
                            <div class="d-flex justify-content-between">
                                <p class="text-dark font-weight-bold text-sm mb-0">Booking Baru</p>
                                <small class="text-muted text-xs">Baru saja</small>
                            </div>
                            <p class="text-muted text-xs mb-0 mt-1"><span class="text-primary">${b.nama}</span> memesan ${b.tipeTenda}.</p>
                        </div>
                    </div>
                `;
            });
        } else {
            activityList.innerHTML = '<p class="text-muted text-sm text-center py-4">Belum ada aktivitas.</p>';
        }

        const ctx = document.getElementById('weeklyChart').getContext('2d');
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(0, 85, 150, 0.2)');
        gradient.addColorStop(1, 'rgba(0, 85, 150, 0)');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Sn', 'Sl', 'Rb', 'Km', 'Jm', 'Sb', 'Mg'],
                datasets: [{
                    label: 'Pendapatan',
                    data: [4.2, 2.5, 5.0, 3.8, 6.5, 8.2, 7.0],
                    backgroundColor: gradient,
                    borderColor: '#005596',
                    borderWidth: 2,
                    pointBackgroundColor: '#ffffff',
                    pointBorderColor: '#EA6C00',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: { borderDash: [5, 5], color: '#F1F5F9', drawBorder: false }, ticks: { display: false } },
                    x: { grid: { display: false }, ticks: { font: { family: 'Poppins', size: 11 }, color: '#94a3b8' } }
                }
            }
        });
    });
</script>
</body>
</html>